<%= form_with(model: @facade.preference, url: @facade.form_url, method: (@facade.preference.persisted? ? :patch : :post), class: "space-y-6") do |f| %>
  <% if @facade.preference.errors.any? %>
    <div class="bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded">
      <h3 class="font-bold">Errors prevented this preference from being saved:</h3>
      <ul class="list-disc list-inside mt-2">
        <% @facade.preference.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="form-group">
    <%= f.label :ingredient_id, "Ingredient", class: "block text-sm font-medium text-gray-700 mb-2" %>
    <%= f.select :ingredient_id, @facade.ingredients, { prompt: "Select an ingredient" }, class: "form-select w-full rounded-md border-gray-300", required: true %>
  </div>

  <div class="form-group">
    <%= f.label :packaging_form, "Packaging", class: "block text-sm font-medium text-gray-700 mb-2" %>
    <%= f.select :packaging_form, @facade.packaging_options, {}, class: "form-select w-full rounded-md border-gray-300" %>
    <p class="mt-1 text-sm text-gray-500">Leave as "Any" for generic preference</p>
  </div>

  <div class="form-group">
    <%= f.label :preparation_style, "Preparation", class: "block text-sm font-medium text-gray-700 mb-2" %>
    <%= f.select :preparation_style, @facade.preparation_options, {}, class: "form-select w-full rounded-md border-gray-300" %>
    <p class="mt-1 text-sm text-gray-500">Leave as "Any" for generic preference</p>
  </div>

  <div class="form-group">
    <%= f.label :preferred_brand, "Preferred Brand", class: "block text-sm font-medium text-gray-700 mb-2" %>
    <%= f.text_field :preferred_brand, class: "form-input w-full rounded-md border-gray-300", placeholder: "e.g., Hunt's, Organic Valley", required: true %>
  </div>

  <div class="flex justify-end space-x-4">
    <%= link_to "Cancel", @facade.cancel_path, class: "btn btn-secondary" %>
    <%= f.submit (@facade.preference.persisted? ? "Update Preference" : "Create Preference"), class: "btn btn-primary" %>
  </div>
<% end %>
