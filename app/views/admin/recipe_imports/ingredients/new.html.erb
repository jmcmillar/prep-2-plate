<%= render HeaderBarComponent.new(title: "Admin") do |c| %>
  <% c.with_breadcrumb_collection(@facade.breadcrumb_trail) %>
<% end %>
<%= render ContainerComponent.new do %>
  <%= render SectionCardComponent.new(title: "Step 3") do %>
    <%= meal_planner_form_with(model: @facade.recipe, url: @facade.form_url, data: {turbo: false}, method: :post) do |form| %>
      <%= render 'components/errors', model: @facade.recipe %>
      <% @facade.ingredients.each_with_index do |ingredient, index| %>
        <% recipe_ingredient = @facade.recipe.recipe_ingredients.build %>
        <%= form.fields_for "recipe_ingredients_attributes[]", recipe_ingredient do |f| %>
          <%= tag.div(class: "row mb-3") do %>
            <%= tag.div(class: "col-2") do %>
              <%= f.input :quantity, value: ingredient[:quantity] %>
            <% end %>
            <%= tag.div(class: "col-2") do %>
              <%= f.searchable_collection_select_input(
                :measurement_unit_id,
                MeasurementUnit.order(:name),
                :id,
                :name,
                {selected: ingredient[:measurement_unit_id], include_blank: true},
              ) %>
            <% end %>
            <%= tag.div(class: "col-2") do %>
              <%= f.input :ingredient_name, value: ingredient[:ingredient_name], label_text: "Ingredient" %>
            <% end %>
            <%= tag.div(class: "col-2") do %>
              <%= f.select_input(:packaging_form, @facade.packaging_form_options, {selected: ingredient[:packaging_form], include_blank: true, label_text: "Packaging"}) %>
            <% end %>
            <%= tag.div(class: "col-2") do %>
              <%= f.select_input(:preparation_style, @facade.preparation_style_options, {selected: ingredient[:preparation_style], include_blank: true, label_text: "Preparation"}) %>
            <% end %>
            <%= tag.div(class: "col-2") do %>
              <%= f.input :ingredient_notes, value: ingredient[:ingredient_notes], label_text: "Notes" %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>
      <%= form.actions cancel_path: :back %>
    <% end %>
  <% end %>
<% end %>
